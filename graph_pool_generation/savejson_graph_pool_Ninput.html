<html>

<head>
    <!-- SCRIPTS -->
    <!-- Reading graph pool generation script -->
    <script src="graph_pool_Ninput_generation.js"></script>
    <!-- Saving files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"
        integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"> </script>
    <!-- Zipping files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <!-- Compressing json files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.11/pako.min.js"></script>

</head>

<body>

    <div style="display: flex;">
        <div style="flex: 1;">
            <h1>NO CLIQUE</h1>
            <h2>Create a number of single graphs WITHOUT the clique, of the given clique size, and saving them to local
                computer using <i>FileSaver</i> JavaScript Library.</h2>
            <div>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[0], 0);">Button
                    1</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[1], 1);">Button
                    2</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[2], 2);">Button
                    3</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[3], 3);">Button
                    4</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[4], 4);">Button
                    5</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[5], 5);">Button
                    6</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[6], 6);">Button
                    7</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[7], 7);">Button
                    8</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[8], 8);">Button
                    9</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[9], 9);">Button
                    10</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[10], 10);">Button
                    11</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[11], 11);">Button
                    12</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[12], 12);">Button
                    13</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[13], 13);">Button
                    14</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithOutClique[14], 14);">Button
                    15</button>
            </div>
        </div>
        <div style="flex: 1;">
            <h1>CLIQUE</h1>
            <h2>Create a number of single graphs WITH the clique, of the given clique size, and saving them to local
                computer using <i>FileSaver</i> JavaScript Library.</h2>
            <div>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[0], 0);">Button
                    1</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[1], 1);">Button
                    2</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[2], 2);">Button
                    3</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[3], 3);">Button
                    4</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[4], 4);">Button
                    5</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[5], 5);">Button
                    6</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[6], 6);">Button
                    7</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[7], 7);">Button
                    8</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[8], 8);">Button
                    9</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[9], 9);">Button
                    10</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[10], 10);">Button
                    11</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[11], 11);">Button
                    12</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[12], 12);">Button
                    13</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[13], 13);">Button
                    14</button>
                <button type="button"
                    onclick="CreateJSONGraphPoolZipFile(graphPoolObject.graphsWithClique[14], 14);">Button
                    15</button>
            </div>
        </div>
    </div>

    <script>

        // Requesting graph size to user:
        let graphSize = Number(prompt("Insert the GRAPH SIZE for which you want to generate the graphs"));

        // Checking that Graph size is an accepted value:
        if (isNaN(graphSize) || ![100, 150, 200, 300, 400, 480, 600, 800, 1000].includes(Number(graphSize))) {
            alert("Invalid graph size. Accepted graph size values for human experiments are: 100, 150, 200, 300, 400, 480, 600, 800, 1000.");
        }

        // Defining clique size array as a proportion of the graph size
        // REFERENCE: N=300 -> cliqueSizeArray = [90, 80, 70, 65, 60, 55, 50, 45, 40, 35, 30, 25, 20, 15, 10] 
        // PROPORTIONS: N -> cliqueSizeArray = [N*(90/300) , N*(80/300), N*(70/300), N*(65/300) , N*(60/300), N*(55/300), N*(50/300) , N*(45/300), N*(40/300), N*(35/300) , N*(30/300), N*(25/300), N*(20/300) , N*(15/300), N*(10/300)]
        cliqueSizeArray = [graphSize * (90 / 300), graphSize * (80 / 300), graphSize * (70 / 300), graphSize * (65 / 300), graphSize * (60 / 300), graphSize * (55 / 300), graphSize * (50 / 300), graphSize * (45 / 300), graphSize * (40 / 300), graphSize * (35 / 300), graphSize * (30 / 300), graphSize * (25 / 300), graphSize * (20 / 300), graphSize * (15 / 300), graphSize * (10 / 300)]
        // Rounding all values in cliqueSizeArray to integers
        cliqueSizeArray = cliqueSizeArray.map(value => Math.round(value));
        console.log("Clique size array: ")
        console.log(cliqueSizeArray)

        //- ARRAY OF NODES IN STANDARD ORDER (needed for generation of graphs with clique)
        let standardOrderOfNodes = new Array();
        for (let index = 0; index < graphSize; index++) {
            standardOrderOfNodes.push(index)
        }

        // CREATING graphPoolObject:
        const graphPoolObject = {
            // graph pool parameters:
            graphSize: graphSize,
            probabilityOfAssociation: 0.5,
            numberOfGraphsPerCliqueSize: 100,
            cliqueSizeArray: cliqueSizeArray,
            standardOrderOfNodes: standardOrderOfNodes,
            // p_correction_type:
            // - p_increase (old correction): increasing the p value of the graph without the clique so that the average degree is matched between the two graphs
            // - p_reduce (new correction): reducing the p value of the graph where the clique will be added     
            pCorrectionType: 'p_reduce',    // 'p_increase' or 'p_reduce'
            // empty objects that will store the graphs:
            graphsWithClique: {},
            graphsWithOutClique: {},
        }


        for (let i = 0; i < cliqueSizeArray.length; i++) {
            console.log("Generating graphs for clique = " + cliqueSizeArray[i])
            // using values of array as keys for object:
            const cliqueSize = cliqueSizeArray[i].toString();

            // - graphs without the clique:
            console.log("- without clique:")
            graphPoolObject.graphsWithOutClique[i] = generateGraphsWithOutClique(graphPoolObject.graphSize, graphPoolObject.cliqueSizeArray[i]);

            // - graphs with the clique:
            console.log("- with clique:")
            graphPoolObject.graphsWithClique[i] = generateGraphsWithClique(graphPoolObject.graphSize, graphPoolObject.cliqueSizeArray[i]);

        }

        console.log("Graph pool object:")
        console.log(graphPoolObject)

        /* SAVING GRAPHS AS SINGLE JSON FILES IF BUTTON IS PRESSED */
        // transforming each graph into .json format to export it
        function CreateJSONGraphPoolZipFile(arrayOfGraphsToSave, index) {
            const zip = new JSZip();

            // Get the clique size
            let cliqueSize = cliqueSizeArray[index];

            // Create a function to add the next file to the zip
            function addNextFile(index) {
                if (index >= arrayOfGraphsToSave.length) {
                    // All files added, generate the zip
                    zip.generateAsync({ type: "blob" }).then(function (content) {
                        saveAs(content, `${cliqueSize.toString().padStart(4, '0')}`);
                    });
                    return;
                }

                // read single json file
                const json = JSON.stringify(arrayOfGraphsToSave[index]);

                // Compress the JSON data using pako
                const compressedJson = pako.gzip(json);

                // Convert the compressed data to a Uint8Array
                const compressedData = new Uint8Array(compressedJson);

                // Convert the Uint8Array to a Blob
                const blob = new Blob([compressedData], { type: "application/octet-stream" });

                // Add the file to the zip
                zip.file(`${arrayOfGraphsToSave[index][graphSize].graph_name}.json`, blob);

                // Add the next file
                addNextFile(index + 1);
            }

            // Start adding the files
            addNextFile(0);
        }

    </script>
</body>

</html>